<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>3D T-Shirt Designer</title>

<!-- Three.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>

<style>
body { margin:0; font-family:Arial; background:#f3f3f3; }
header { text-align:center; padding:20px; background:#222; color:#fff; font-size:24px; }
.wrap { display:flex; flex-wrap:wrap; gap:20px; padding:20px; max-width:1200px; margin:auto; }
.viewer { flex:1; background:#fff; border-radius:10px; padding:10px; display:flex; flex-direction:column; align-items:center; }
#canvasContainer { width:100%; height:600px; border-radius:8px; overflow:hidden; background:#eee; }
.panel { width:300px; background:#fff; padding:16px; border-radius:10px; display:flex; flex-direction:column; gap:12px; }
button { background:#06b6d4; border:none; padding:10px; border-radius:6px; color:#012; cursor:pointer; }
input[type=file] { cursor:pointer; }
</style>
</head>
<body>

<header>3D T-Shirt Designer</header>

<div class="wrap">
  <div class="viewer">
    <div id="canvasContainer"></div>
  </div>

  <div class="panel">
    <label>Upload Design:</label>
    <input type="file" id="designInput" accept="image/*">
    <button id="screenshotBtn">Download PNG</button>
    <button id="resetBtn">Reset Design</button>
  </div>
</div>

<script>
const container = document.getElementById('canvasContainer');
let scene, camera, renderer, controls;
let tshirtMesh = null;
let currentTexture = null;

// 3D scene init
function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xf3f3f3);

  const width = container.clientWidth;
  const height = container.clientHeight;
  camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 1000);
  camera.position.set(0, 1.5, 3);

  const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
  hemiLight.position.set(0, 1, 0);
  scene.add(hemiLight);

  const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
  dirLight.position.set(5,10,5);
  scene.add(dirLight);

  renderer = new THREE.WebGLRenderer({antialias:true, preserveDrawingBuffer:true});
  renderer.setSize(width,height);
  container.appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  window.addEventListener('resize', onWindowResize);

  loadTshirtModel();

  animate();
}

// Load T-shirt GLB
function loadTshirtModel() {
  const loader = new THREE.GLTFLoader();
  const url = './models/tshirt.glb'; // replace with actual T-shirt model

  loader.load(url, gltf => {
    tshirtMesh = gltf.scene;
    tshirtMesh.scale.set(1.5,1.5,1.5);
    scene.add(tshirtMesh);
  }, undefined, err=>console.error(err));
}

// Apply uploaded design as texture
document.getElementById('designInput').addEventListener('change', (ev)=>{
  const f = ev.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  const loader = new THREE.TextureLoader();
  loader.crossOrigin = '';
  loader.load(url, tex => {
    if(currentTexture) currentTexture.dispose();
    currentTexture = tex;
    if(tshirtMesh) tshirtMesh.traverse(obj=>{
      if(obj.isMesh){
        obj.material.map = tex;
        obj.material.needsUpdate = true;
      }
    });
  });
});

// Download canvas as PNG
document.getElementById('screenshotBtn').addEventListener('click', ()=>{
  const data = renderer.domElement.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = data;
  a.download = 'tshirt-design.png';
  a.click();
});

// Reset design
document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(tshirtMesh){
    tshirtMesh.traverse(obj=>{
      if(obj.isMesh){
        if(obj.material.map){ obj.material.map.dispose(); obj.material.map=null; obj.material.needsUpdate=true; }
      }
    });
  }
  document.getElementById('designInput').value='';
  currentTexture=null;
});

function onWindowResize(){
  const w = container.clientWidth;
  const h = container.clientHeight;
  camera.aspect = w/h;
  camera.updateProjectionMatrix();
  renderer.setSize(w,h);
}

function animate(){
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene,camera);
}

init();
</script>

</body>
</html>
